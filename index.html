<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flippy Truck Game - Rafael Silva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;700;900&display=swap');
        
        * { -webkit-tap-highlight-color: transparent; user-select: none; }
        
        @keyframes bg-shimmer {
            0% { background-position: 0% 50%; background-color: #020617; }
            50% { background-position: 100% 50%; background-color: #1e1b4b; }
            100% { background-position: 0% 50%; background-color: #020617; }
        }

        body { 
            background: #020617; margin: 0; overflow: hidden; 
            font-family: 'Inter', sans-serif; color: white; touch-action: none; 
            height: 100vh; display: flex; flex-direction: column;
        }
        .font-header { font-family: 'Orbitron', sans-serif; }

        @keyframes neon-glow {
            0%, 100% { opacity: 1; text-shadow: 0 0 15px currentColor; box-shadow: 0 0 15px currentColor; border-color: currentColor; }
            50% { opacity: 0.7; text-shadow: 0 0 5px currentColor; box-shadow: 0 0 5px currentColor; border-color: currentColor; }
        }
        .neon-pulse { animation: neon-glow 2.5s infinite ease-in-out; }
        .oval-container { border-radius: 9999px; border-width: 2px; padding: 12px 24px; }

        #gasPedal { 
            width: 70px; 
            height: 110px; 
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 3px solid #a855f7;
            border-radius: 15px 15px 10px 10px;
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: space-between; 
            padding: 10px 0;
            pointer-events: auto;
            transform: perspective(100px) rotateX(10deg);
            box-shadow: 0 10px 20px rgba(0,0,0,0.5), 0 0 15px rgba(168, 85, 247, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        #gasPedal:active {
            transform: perspective(100px) rotateX(25deg) scale(0.92);
            box-shadow: 0 2px 10px rgba(0,0,0,0.8), 0 0 25px rgba(168, 85, 247, 0.7);
            background: #1e1b4b;
        }

        .pedal-line { width: 40px; height: 4px; background: rgba(168, 85, 247, 0.3); border-radius: 2px; }

        .overlay-screen { 
            position: absolute; inset: 0; z-index: 100; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center;
            background: linear-gradient(-45deg, #020617, #0f172a, #1e1b4b, #020617);
            background-size: 400% 400%;
            animation: bg-shimmer 8s infinite ease-in-out;
        }

        #game-wrapper { flex: 1; position: relative; width: 100%; background: black; overflow: hidden; }
        canvas { width: 100%; height: 100%; }

        #mobile-hud {
            position: absolute; bottom: 10%; right: 12%;
            display: none; flex-direction: column; align-items: center; 
            gap: 25px; z-index: 150; pointer-events: none;
        }

        .diff-btn { width: 85%; max-width: 280px; margin: 12px; font-weight: 900; text-transform: uppercase; background: rgba(0,0,0,0.3); letter-spacing: 2px; }

        #countdown-container {
            position: absolute; inset: 0; display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 140; background: rgba(0,0,0,0.4);
        }
    </style>
</head>
<body>

    <div id="top-msg" class="w-full text-center py-4 bg-slate-950 border-b border-purple-900 z-[110]">
        <div class="inline-block oval-container neon-pulse text-purple-400">
            <h2 class="font-header text-[10px]">Flippy Truck Game - entregue a carga no prazo!</h2>
        </div>
    </div>

    <div id="game-wrapper">
        <canvas id="game"></canvas>

        <div id="start-screen" class="overlay-screen flex">
            <div class="flex flex-col items-center mb-10">
                <div class="oval-container neon-pulse px-10 text-white border-white">
                    <h1 class="font-header text-2xl">Flippy Truck Game</h1>
                </div>
                <p class="text-purple-400 font-header text-[10px] mt-4 tracking-widest opacity-80">Criado por Rafael Silva</p>
            </div>

            <button onclick="selectDifficulty(380, 1.8, true)" class="diff-btn oval-container neon-pulse text-emerald-400 border-emerald-500">Fácil</button>
            <button onclick="selectDifficulty(280, 2.8, false)" class="diff-btn oval-container neon-pulse text-amber-400 border-amber-500">Médio</button>
            <button onclick="selectDifficulty(200, 4.0, false)" class="diff-btn oval-container neon-pulse text-red-400 border-red-500">Difícil</button>
        </div>

        <div id="game-over-screen" class="overlay-screen hidden">
            <div class="oval-container neon-pulse mb-10 text-red-600">
                <h1 class="font-header text-4xl uppercase">Bateu!</h1>
            </div>
            <button onclick="restartSameLevel()" class="diff-btn oval-container neon-pulse text-white">RECOMEÇAR</button>
            <button onclick="backToMenu()" class="diff-btn oval-container neon-pulse text-purple-400">DIFICULDADE</button>
        </div>

        <div id="victory-screen" class="overlay-screen hidden">
            <div class="oval-container neon-pulse mb-8 text-green-500">
                <h1 class="font-header text-3xl">Carga entregue</h1>
            </div>
            <button onclick="backToMenu()" class="diff-btn oval-container neon-pulse text-green-400">VOLTAR AO MENU</button>
        </div>

        <div id="countdown-container">
            <div id="countdown" class="font-header text-9xl text-purple-500 mb-4">3</div>
            <div class="oval-container border-purple-500 bg-black/60 neon-pulse">
                <p class="font-header text-[10px] text-white tracking-widest text-center">
                    TOQUE NO PEDAL PARA DESVIAR<br>DOS OBSTÁCULOS
                </p>
            </div>
        </div>

        <div id="mobile-hud">
            <div class="oval-container neon-pulse text-purple-500 border-purple-600 px-6 py-2 bg-black/80">
                <p class="text-[9px] uppercase font-bold text-slate-400 text-center">Caixas</p>
                <p id="boxCount" class="text-3xl font-black italic text-center">10</p>
            </div>
            
            <div id="gasPedal">
                <div class="pedal-line"></div>
                <div class="pedal-line"></div>
                <div class="pedal-line"></div>
                <span class="font-black text-[9px] text-purple-400 uppercase">Acelerar</span>
                <div class="pedal-line"></div>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game');
        const ctx = canvas.getContext('2d');
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playNote(freq, dur, type = 'sine', vol = 0.1) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        function resizeCanvas() {
            const wrapper = document.getElementById('game-wrapper');
            canvas.width = wrapper.clientWidth;
            canvas.height = wrapper.clientHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let gameGap, gameSpeed, isEasyMode, gameActive = false, requestID;
        let boxes = 10, gravity = 0.22, velocity = 0, pipes = [];
        const truck = { x: 40, y: 50, w: 55, h: 35 };

        function drawTruck() {
            ctx.fillStyle = "#fbbf24"; // Cor das caixas
            // Ajuste para desenhar até 12 caixas organizadas
            for(let i = 0; i < boxes; i++) { 
                ctx.fillRect(truck.x + (i % 4) * 9, truck.y - 10 - Math.floor(i / 4) * 8, 7, 7); 
            }
            ctx.fillStyle = "#64748b"; ctx.fillRect(truck.x, truck.y, 40, 30);
            ctx.fillStyle = "#1e40af"; ctx.fillRect(truck.x + 40, truck.y + 8, 15, 22);
            ctx.fillStyle = "#a5f3fc"; ctx.fillRect(truck.x + 48, truck.y + 12, 5, 8);
            [8, 28, 48].forEach(rx => {
                ctx.fillStyle = "black"; ctx.beginPath(); ctx.arc(truck.x + rx, truck.y + 30, 5, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "#94a3b8"; ctx.beginPath(); ctx.arc(truck.x + rx, truck.y + 30, 2, 0, Math.PI*2); ctx.fill();
            });
        }

        function loop() {
            if (!gameActive) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            velocity += gravity;
            truck.y += velocity;

            if (pipes.length === 0 || pipes[pipes.length-1].x < canvas.width - 240) {
                let minH = canvas.height * 0.15;
                let maxH = canvas.height * 0.45;
                let yPos = Math.random() * (maxH - minH) + minH;
                let currentGap = isEasyMode ? gameGap - 60 : gameGap;
                pipes.push({ x: canvas.width, y: yPos, passed: false, customGap: currentGap });
            }

            pipes.forEach(p => {
                p.x -= gameSpeed;
                ctx.fillStyle = "#1e293b";
                ctx.fillRect(p.x, 0, 55, p.y);
                ctx.fillRect(p.x, p.y + p.customGap, 55, canvas.height); 

                if (truck.x + truck.w > p.x && truck.x < p.x + 55) {
                    if (truck.y < p.y || truck.y + truck.h > p.y + p.customGap) gameOver();
                }

                if (!p.passed && p.x < truck.x) {
                    p.passed = true;
                    boxes--;
                    document.getElementById('boxCount').innerText = boxes;
                    playNote(900, 0.1);
                    if (boxes <= 0) victory();
                }
            });

            pipes = pipes.filter(p => p.x > -60);
            if (truck.y > canvas.height || truck.y < -50) gameOver();

            drawTruck();
            requestID = requestAnimationFrame(loop);
        }

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(requestID);
            [330, 261].forEach((f, i) => setTimeout(() => playNote(f, 0.5, 'triangle'), i * 300));
            document.getElementById('mobile-hud').style.display = 'none';
            document.getElementById('game-over-screen').classList.replace('hidden', 'flex');
        }

        function victory() {
            gameActive = false;
            cancelAnimationFrame(requestID);
            [523, 783, 1046].forEach((f, i) => setTimeout(() => playNote(f, 0.4), i * 150));
            document.getElementById('mobile-hud').style.display = 'none';
            document.getElementById('victory-screen').classList.replace('hidden', 'flex');
        }

        function selectDifficulty(gap, speed, easy) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            gameGap = gap; gameSpeed = speed; isEasyMode = easy;
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('top-msg').classList.add('hidden');
            resetGame();
            startCountdown();
        }

        function startCountdown() {
            const container = document.getElementById('countdown-container');
            const cd = document.getElementById('countdown');
            const hud = document.getElementById('mobile-hud');
            let count = 3;
            cd.innerText = count;
            container.style.display = 'flex';
            hud.style.display = 'flex';
            
            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    cd.innerText = count;
                    playNote(400, 0.1);
                } else if (count === 0) {
                    cd.innerText = "GO!";
                    playNote(800, 0.2);
                } else {
                    clearInterval(timer);
                    container.style.display = 'none';
                    gameActive = true;
                    loop();
                }
            }, 900);
        }

        function resetGame() {
            // NOVIDADE: Nível fácil começa com 12 caixas, outros com 10.
            boxes = isEasyMode ? 12 : 10; 
            velocity = -0.5; 
            gravity = 0.10; 
            truck.y = canvas.height / 2; 
            pipes = [];
            document.getElementById('boxCount').innerText = boxes;
            setTimeout(() => { if(gameActive) gravity = 0.22; }, 2500);
        }

        function restartSameLevel() {
            document.getElementById('game-over-screen').classList.replace('flex', 'hidden');
            resetGame(); startCountdown();
        }

        function backToMenu() {
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('victory-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.replace('hidden', 'flex');
            document.getElementById('top-msg').classList.remove('hidden');
        }

        const pedal = document.getElementById('gasPedal');
        const jump = (e) => { 
            e.preventDefault(); 
            velocity = -5.0; 
            playNote(150, 0.05, 'triangle', 0.15); 
        };
        pedal.addEventListener('touchstart', jump);
        pedal.addEventListener('mousedown', jump);

        window.onload = () => { resizeCanvas(); drawTruck(); };
    </script>
</body>
</html>
